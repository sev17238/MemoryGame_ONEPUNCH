<!DOCTYPE html>
<html lang="en">
  <head>
    <title>OnePunchMan_MemoryGame</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link rel="stylesheet" href="Lab6Style.css">
  </head>  
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      // Modified Shuffle by Chris Coyier
      // https://css-tricks.com/snippets/javascript/shuffle-array/
      function shuffle(o) {
        for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
        return o;
      };

      /* This function set randomly images to the cards displayed on the screen on render.
        */
      function CardsShuffleInGrid() {          
        const images = ["Boros.png","DeepSeaKing.png","Garou.png","Genos.png","King.png","Saitama.png","SilverFang.png","Sonic.png","Suiryu.png","Tatsumaki.png","Fubuki.png","MetalBat.png"];
        let cards = [];
        while (cards.length < 24) {
          const index = Math.floor(Math.random() * images.length);
          const card = {
            image: images.splice(index, 1)[0],
            guessedRight: false
          }
          cards.push(card);
          cards.push({...card}) //card clone: This is useful to have another reference of the object
          //console.log(card.image)
        }
        return shuffle(cards);
      };

      /* This function set randomly images to the cards displayed on the screen on render.
        */
        function CardsShuffleInGrid2() {          
        const images = ["BackCard.png"];
        let cards = [];
        while (cards.length < 24) {
          const index = Math.floor(Math.random() * images.length);
          const card = {
            image: images.splice(index, 1)[0],
            guessedRight: false
          }
          cards.push(card);
          cards.push({...card}) //card clone: This is useful to have another reference of the object
          //console.log(card.image)
        }
        return shuffle(cards);
      };
      
      
              
      class HeaderBar extends React.Component{
        render(){
          return(
            <div>
            <header>
              <div className="title">ONE PUNCH MEMORY</div>
              <div>
                <button className="restartButton">Reset Game</button>
              </div>
              <div className="moveCount">Movements: </div>
            </header>
            </div>
          )
        }
      }

      class Card extends React.Component {      
        constructor(props) {
          super(props)
          this.state = {
            side: "cardback"
          };

        }

        handleClick(){
          if (this.state.side == "cardfront") {
            this.setState({
              side: "cardback"
            });
          } else if (this.state.side == "cardback") {
            this.setState({
              side: "cardfront"
            });
          }

        }

        render() {         
          return (
            <div className="Card">            
              <div onClick={this.handleClick.bind(this)}>
              {
                this.state.side == "cardfront" ? (
                  <div className="CardFront">
                    <img className="OnePunchCharacter" src ={`CardImages/${this.props.image}`}/>
                  </div>
                ) : (
                  <div className="CardBack" >
                    <img className="OnePunchLogo" src = "CardImages/CardBack.png"/>
                  </div>   
                )
              }
              </div>            
            </div>
          )
        }
      }

      class CardsGrid extends React.Component{
        render(){
          //const cards = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];
          return(
          <div className="firstDiv">
            <div className="grid-container">                
            {
              //cards.map((card) => <Card></Card>)           
              this.props.deckOfCards.map((card, index) =>
                //const isBeingCompared = this.props.selectedMatchingCards.indexOf(card) > -1;
                <Card image={card.image} 
                /*key={index}  isBeingCompared = {isBeingCompared} selectCard={() => this.props.selectCard(card)} guessedRight={card.guessedRight}*/
                />  
              ) //image defined in cardsShuffleInGrid
              
            }
            </div>
          </div>
          )
        }
      }

      /* This function has the initState of the cards inside the grid.
      */
      const getInitState = () => {
        const deckOfCards = CardsShuffleInGrid();
        return{
          deckOfCards,
          selectedMatchingCards: [],
          isComparing: false
        };
      }

      class Game extends React.Component {
        constructor(props) {
          super(props);  

          this.state = getInitState();        
        }        

        
        

        render() {
          return (
            <div>
              <div >
                <HeaderBar/>
              </div>
              <div onClick={this.handleClick} >
                <CardsGrid
                deckOfCards={this.state.deckOfCards} 
                selectedMatchingCards = {this.state.selectedMatchingCards}
                selectingCard = {(card) => this.selectingCard(card)}
                />
              </div>
            </div>
          );       
        }

      //Selecting the cards
        selectCard(card){
          if(this.state.isComparing || this.state.selectedMatchingCards.indexOf(card) > -1 || card.guessedRight)
          {
            return;
          }

          const selectedMatchingCards = [...this.state.selectedMatchingCards,card];
          this.setState({
            selectedMatchingCards
          })
        }
      }
      //-------------------------
      
      ReactDOM.render(
        <Game />,
        document.getElementById('root')
      )

    </script>
  </body>

  <!--REFERENCES: 
   https://codepen.io/bitmapshades/pen/raOZMa
   https://codepen.io/yigitcukuren/pen/GyxxVm?editors=0110
   https://www.youtube.com/watch?v=fHosG9DpIcs&list=PLImOJ2OqvvkBvWlM7wNh7_gcjP_kPDxRc&index=8-->
</html>

